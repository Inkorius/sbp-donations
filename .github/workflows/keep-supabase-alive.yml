name: Keep Supabase Alive (Random)

on:
  schedule:
    # Запуск каждый час
    - cron: '0 * * * *'
  workflow_dispatch:  # позволяет запускать вручную

jobs:
  random-ping:
    runs-on: ubuntu-latest
    steps:
      # Генерация случайного числа от 0 до 7
      - name: Generate random number
        id: random
        run: echo "value=$(( RANDOM % 8 ))" >> $GITHUB_OUTPUT

      # Выполнение запроса только с вероятностью 1/8 (в среднем 3 раза в день)
      - name: Ping Supabase with probability 1/8
        if: steps.random.outputs.value == 0
        env:
          SUPABASE_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
        run: |
          curl -s -o /dev/null -w "%{http_code}\n" \
            https://rvbduwlfnhepnknrhtaz.supabase.co/rest/v1/ \
            -H "apikey: ${SUPABASE_KEY}"